# Google Sheets 数据收集设置指南

## 步骤 1：创建 Google Sheets

1. 访问 [Google Sheets](https://sheets.google.com)
2. 创建一个新的表格，命名为"行为经济学实验数据"

## 步骤 2：设置 Apps Script

1. 在 Google Sheets 中，点击菜单：**扩展程序** → **Apps Script**
2. 删除默认的代码
3. 复制 `google-apps-script/Code.gs` 中的代码并粘贴
4. 点击保存（💾）图标

## 步骤 3：初始化表格表头

1. 在 Apps Script 编辑器中，选择函数 `setupSheet`
2. 点击运行（▶️）按钮
3. 首次运行需要授权，点击"审核权限"并授权
4. 返回 Google Sheets，您会看到表头已经创建

## 步骤 4：部署为 Web App

1. 在 Apps Script 编辑器中，点击右上角的 **部署** → **新建部署**
2. 点击"选择类型"旁边的齿轮图标，选择 **Web 应用**
3. 填写以下信息：
   - **说明**：实验数据收集 API
   - **执行身份**：我
   - **有权访问应用的用户**：任何人
4. 点击 **部署**
5. 复制生成的 **Web 应用 URL**（类似：`https://script.google.com/macros/s/AKfycby.../exec`）

## 步骤 5：配置前端

1. 将复制的 Web 应用 URL 添加到项目的环境变量中
2. 在 Vercel 项目设置中添加环境变量：
   - 变量名：`NEXT_PUBLIC_GOOGLE_SHEETS_URL`
   - 值：您复制的 Web 应用 URL

## 数据结构说明

表格包含以下列：

| 列名 | 说明 |
|------|------|
| 提交时间 | 被试者提交实验的时间戳 |
| 任务类型 | 写作 或 阅读 |
| 实验类型 | 实验①、实验②、实验③ 或 阅读任务 |
| 年级 | 被试者的年级 |
| 学科 | 被试者的学科背景 |
| 分数段 | 被试者的结课论文平均分数段 |
| 修改时间(秒) | 实验①的修改用时 |
| 实验完成总时间(秒) | 从确认规则到提交的总时间 |
| 写作时间(秒) | 实验②③的写作用时 |
| 写作字数 | 写作内容的字数 |
| 是否添加修正标签 | 实验②③中是否选择添加修正标签 |
| 修改内容 | 实验①的修改内容 |
| 写作内容 | 写作的项目背景内容 |
| 问卷答案(JSON) | 实验①的问卷答案 |
| 转发文章列表(JSON) | 阅读任务中转发的文章 |
| 转发文章数量 | 转发的文章总数 |
| 标签统计(JSON) | 各类标签的转发数量统计 |

## 测试

部署完成后，您可以在前端提交一次测试数据，检查是否成功写入 Google Sheets。

## 故障排除

如果数据没有写入：
1. 检查 Apps Script 的执行日志（查看 → 执行）
2. 确认 Web 应用的访问权限设置为"任何人"
3. 确认环境变量 URL 正确无误
4. 检查浏览器控制台是否有错误信息
